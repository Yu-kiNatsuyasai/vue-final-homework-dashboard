"use strict";(self["webpackChunkvue_final_homework"]=self["webpackChunkvue_final_homework"]||[]).push([[240],{3240:function(t,e,l){l.r(e),l.d(e,{default:function(){return ut}});var a=l(3396),d=l(7139),i=l(9242);const s={class:"text-end"},r=(0,a._)("h1",null,"訂單列表",-1),o={class:"table mt-4"},n=(0,a._)("thead",null,[(0,a._)("tr",null,[(0,a._)("th",null,"購買時間"),(0,a._)("th",null,"Email"),(0,a._)("th",null,"購買款項"),(0,a._)("th",null,"應付金額"),(0,a._)("th",null,"是否付款"),(0,a._)("th",null,"編輯")])],-1),u=["textContent"],p={class:"list-unstyled"},c={class:"text-right"},_={class:"form-check form-switch"},h=["id","onUpdate:modelValue","onChange"],m=["for"],g={key:0},b={key:1},w={class:"btn-group"},y=["onClick"],k=["onClick"];function f(t,e,l,f,O,L){const x=(0,a.up)("VLoading"),D=(0,a.up)("Pagination"),v=(0,a.up)("order-modal"),M=(0,a.up)("del-modal");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(x,{active:O.isLoading},null,8,["active"]),(0,a._)("div",s,[(0,a._)("button",{class:"btn btn-danger",type:"button",onClick:e[0]||(e[0]=t=>L.openDelModal({id:"all",title:"所有訂單"}))}," 刪除所有訂單 ")]),r,(0,a._)("table",o,[n,(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(O.orders,(e=>((0,a.wg)(),(0,a.iD)(a.HY,{key:e.id},[O.orders.length?((0,a.wg)(),(0,a.iD)("tr",{key:0,class:(0,d.C_)({"text-secondary":!e.is_paid})},[(0,a._)("td",null,(0,d.zw)(t.$filters.date(e.create_at)),1),(0,a._)("td",null,[e.user?((0,a.wg)(),(0,a.iD)("span",{key:0,textContent:(0,d.zw)(e.user.email)},null,8,u)):(0,a.kq)("",!0)]),(0,a._)("td",null,[(0,a._)("ul",p,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.products,(t=>((0,a.wg)(),(0,a.iD)("li",{key:t.id},(0,d.zw)(t.product.title)+" 數量："+(0,d.zw)(t.qty)+(0,d.zw)(t.product.unit),1)))),128))])]),(0,a._)("td",c,(0,d.zw)(e.total),1),(0,a._)("td",null,[(0,a._)("div",_,[(0,a.wy)((0,a._)("input",{type:"checkbox",class:"form-check-input",id:`${e.id}paid`,"onUpdate:modelValue":t=>e.is_paid=t,onChange:t=>L.updatePaid(e)},null,40,h),[[i.e8,e.is_paid]]),(0,a._)("label",{class:"form-check-label",for:`${e.id}paid`},[e.is_paid?((0,a.wg)(),(0,a.iD)("span",g,"已付款")):((0,a.wg)(),(0,a.iD)("span",b,"未付款"))],8,m)])]),(0,a._)("td",null,[(0,a._)("div",w,[(0,a._)("button",{class:"btn btn-outline-primary btn-sm",onClick:t=>L.openModal(!1,e)},"檢視",8,y),(0,a._)("button",{class:"btn btn-outline-danger btn-sm",onClick:t=>L.openDelModal(e)},"刪除",8,k)])])],2)):(0,a.kq)("",!0)],64)))),128))])]),(0,a.Wm)(D,{pages:O.pagination,onEmitPages:L.getOrders},null,8,["pages","onEmitPages"]),(0,a.Wm)(v,{ref:"orderModal",order:O.tempOrder,onUpdateOrder:L.updateOrder},null,8,["order","onUpdateOrder"]),(0,a.Wm)(M,{ref:"delModal",item:O.tempOrder,onDelItem:L.delOrder},null,8,["item","onDelItem"])],64)}const O={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},L={class:"modal-dialog modal-xl",role:"document"},x={class:"modal-content border-0"},D=(0,a._)("div",{class:"modal-header bg-dark text-white"},[(0,a._)("h5",{class:"modal-title",id:"exampleModalLabel"},[(0,a._)("span",null,"訂單細節")]),(0,a._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),v={class:"modal-body"},M={class:"row"},$={class:"col-md-4"},z=(0,a._)("h3",null,"用戶資料",-1),q={class:"table"},C={key:0},P=(0,a._)("th",{style:{width:"100px"}},"姓名",-1),Y=(0,a._)("th",null,"Email",-1),Z=(0,a._)("th",null,"電話",-1),R=(0,a._)("th",null,"地址",-1),I={class:"col-md-8"},K=(0,a._)("h3",null,"訂單細節",-1),A={class:"table"},B=(0,a._)("th",{style:{width:"100px"}},"訂單編號",-1),E=(0,a._)("th",null,"下單時間",-1),S=(0,a._)("th",null,"付款時間",-1),j={key:0},U={key:1},H=(0,a._)("th",null,"付款狀態",-1),W={key:0,class:"text-success"},Q={key:1,class:"text-muted"},N=(0,a._)("th",null,"總金額",-1),V=(0,a._)("h3",null,"選購商品",-1),F={class:"table"},G=(0,a._)("thead",null,[(0,a._)("tr")],-1),J={class:"text-end"},T={class:"modal-footer"},X=(0,a._)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function tt(t,e,l,i,s,r){return(0,a.wg)(),(0,a.iD)("div",O,[(0,a._)("div",L,[(0,a._)("div",x,[D,(0,a._)("div",v,[(0,a._)("div",M,[(0,a._)("div",$,[z,(0,a._)("table",q,[s.tempOrder.user?((0,a.wg)(),(0,a.iD)("tbody",C,[(0,a._)("tr",null,[P,(0,a._)("td",null,(0,d.zw)(s.tempOrder.user.name),1)]),(0,a._)("tr",null,[Y,(0,a._)("td",null,(0,d.zw)(s.tempOrder.user.email),1)]),(0,a._)("tr",null,[Z,(0,a._)("td",null,(0,d.zw)(s.tempOrder.user.tel),1)]),(0,a._)("tr",null,[R,(0,a._)("td",null,(0,d.zw)(s.tempOrder.user.address),1)])])):(0,a.kq)("",!0)])]),(0,a._)("div",I,[K,(0,a._)("table",A,[(0,a._)("tbody",null,[(0,a._)("tr",null,[B,(0,a._)("td",null,(0,d.zw)(s.tempOrder.id),1)]),(0,a._)("tr",null,[E,(0,a._)("td",null,(0,d.zw)(t.$filters.date(s.tempOrder.create_at)),1)]),(0,a._)("tr",null,[S,(0,a._)("td",null,[s.tempOrder.paid_date?((0,a.wg)(),(0,a.iD)("span",j,(0,d.zw)(t.$filters.date(s.tempOrder.paid_date)),1)):((0,a.wg)(),(0,a.iD)("span",U,"時間不正確"))])]),(0,a._)("tr",null,[H,(0,a._)("td",null,[s.tempOrder.is_paid?((0,a.wg)(),(0,a.iD)("strong",W,"已付款")):((0,a.wg)(),(0,a.iD)("span",Q,"尚未付款"))])]),(0,a._)("tr",null,[N,(0,a._)("td",null,(0,d.zw)(t.$filters.currency(s.tempOrder.total)),1)])])]),V,(0,a._)("table",F,[G,(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(s.tempOrder.products,(e=>((0,a.wg)(),(0,a.iD)("tr",{key:e.id},[(0,a._)("th",null,(0,d.zw)(e.product.title),1),(0,a._)("td",null,(0,d.zw)(e.qty)+" / "+(0,d.zw)(e.product.unit),1),(0,a._)("td",J,(0,d.zw)(t.$filters.currency(e.final_total)),1)])))),128))])])])])]),(0,a._)("div",T,[X,(0,a._)("button",{type:"button",class:"btn btn-primary",onClick:e[0]||(e[0]=e=>t.$emit("update-order",s.tempOrder))}," 更新 ")])])])],512)}var et=l(1339),lt={name:"orderModal",props:{order:{type:Object,default(){return{}}}},data(){return{status:{},modal:"",tempOrder:{},isPaid:!1}},mixins:[et.Z],watch:{order(){this.tempOrder=this.order,this.isPaid=this.tempOrder.is_paid}}},at=l(89);const dt=(0,at.Z)(lt,[["render",tt]]);var it=dt,st=l(3250),rt=l(7336),ot={components:{OrderModal:it,DelModal:st.Z,Pagination:rt.Z},inject:["ajaxStateMessage"],data(){return{orders:[],pagination:{},tempOrder:{},isNew:!1,isLoading:!1}},methods:{getOrders(t=1){this.isLoading=!0;const e=`https://vue3-course-api.hexschool.io/api/yu-ki-api/admin/orders?page=${t}`;this.$http.get(e).then((t=>{t.data.success?(this.orders=[{create_at:1523539834,id:"-L9u2EUkQSoEmW7QzGLF",is_paid:!0,message:"這是留言",paid_date:1523539924,payment_method:"credit_card",products:{L8nBrq8Ym4ARI1Kog4t:{product:{title:"美味的甜甜花釀雞",unit:"盤"},id:"L8nBrq8Ym4ARI1Kog4t",product_id:"-L8moRfPlDZZ2e-1ritQ",qty:"3",final_total:8700},L8nBrq8Ym4ARI1Kog4y:{product:{title:"肉肉烤蘑菇披薩",unit:"盤"},id:"L8nBrq8Ym4ARI1Kog4y",product_id:"-L8moRfPlDZZ2e-1ritR",qty:"3",final_total:87}},total:8787,user:{address:"kaohsiung",email:"test@gmail.com",name:"test",tel:"0912346768"},num:1},{create_at:1523539519,id:"-L9u11NAE0m0SpSBUDIq",is_paid:!1,message:"這是留言",payment_method:"credit_card",products:{L8nBrq8Ym4ARI1Kog4t:{product:{title:"美味的甜甜花釀雞",unit:"盤"},id:"L8nBrq8Ym4ARI1Kog4t",product_id:"-L8moRfPlDZZ2e-1ritQ",qty:"3",final_total:8700}},total:8700,user:{address:"kaohsiung",email:"test@gmail.com",name:"test",tel:"0912346768"},num:2}],this.pagination={total_pages:1,current_page:1,has_pre:!1,has_next:!1,category:null},this.isLoading=!1):(console.log(t.data.error),alert(t.data.message+"，"+t.data.error.message)),this.isLoading=!1})).catch((t=>{console.log(t),this.isLoading=!1}))},openModal(t,e){this.tempOrder=t?{}:{...e},this.isNew=t,this.$refs.orderModal.showModal()},updateOrder(t){this.isLoading=!0;const e=`https://vue3-course-api.hexschool.io/api/yu-ki-api/admin/order/${t.id}`;this.$http.put(e,{data:t}).then((t=>{this.isLoading=!1,this.$refs.orderModal.hideModal(),this.getOrders(),this.ajaxStateMessage(t,"更新訂單")}))},updatePaid(t){this.isLoading=!0;const e=`https://vue3-course-api.hexschool.io/api/yu-ki-api/admin/order/${t.id}`,l={is_paid:t.is_paid};this.$http.put(e,{data:l}).then((t=>{this.isLoading=!1,this.getOrders(),this.ajaxStateMessage(t,"更新付款狀態")}))},openDelModal(t){this.tempOrder={...t},this.$refs.delModal.showModal()},delOrder(t){this.isLoading=!0;let e=`https://vue3-course-api.hexschool.io/api/yu-ki-api/admin/order/${t.id}`;"all"===t.id&&(e="https://vue3-course-api.hexschool.io/api/yu-ki-api/admin/orders/all"),this.$http.delete(e).then((t=>{t.data.success&&(this.$refs.delModal.hideModal(),this.getOrders()),this.ajaxStateMessage(t,"刪除"),this.isLoading=!1})).catch((t=>{console.log(t),this.isLoading=!1}))}},created(){this.getOrders()}};const nt=(0,at.Z)(ot,[["render",f]]);var ut=nt}}]);
//# sourceMappingURL=240.2539d407.js.map